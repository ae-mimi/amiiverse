---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection, getEntry } from "astro:content";

const releases = await getCollection("releases");
const musicPage = await getEntry("pages", "music");
if (!musicPage) {
    throw new Error("Could not find 'music' page content");
}
const { data } = musicPage;

const sortedReleases = releases.sort(
    (a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
);
---

<BaseLayout title={data.title || "Music | amii"}>
    <section class="section container" style="max-width: 1200px;">
        <h1
            class="font-heading text-center"
            style="font-size: 2.5rem; margin-bottom: 3rem;"
        >
            {data.heading || "Discography"}
        </h1>

        {
            sortedReleases.length === 0 ? (
                <div class="text-center" style="padding: 5rem 0; opacity: 0.6;">
                    <p>{data.emptyStateText || "No releases found yet."}</p>
                    <p style="font-size: 0.9rem; margin-top: 0.5rem;">
                        {data.emptyStateSubtext ||
                            "Check back soon for our debut."}
                    </p>
                </div>
            ) : (
                <div class="grid cols-2">
                    {sortedReleases.map((release) => (
                        <article class="release-card">
                            <a
                                href={`/releases/${release.slug}`}
                                style="display: block; overflow: hidden; border-radius: 8px; margin-bottom: 1rem;"
                            >
                                <img
                                    src={release.data.cover}
                                    alt={release.data.title}
                                    class="hover-zoom"
                                    style="width: 100%; aspect-ratio: 1/1; object-fit: cover; transition: transform 0.5s;"
                                />
                            </a>
                            <h2
                                class="font-heading"
                                style="font-size: 1.5rem; margin-bottom: 0.25rem;"
                            >
                                {release.data.title}
                            </h2>
                            <p
                                class="opacity-60"
                                style="font-size: 0.9rem; margin-bottom: 0.5rem;"
                            >
                                {release.data.date.toLocaleDateString()}
                            </p>
                            <p style="margin-bottom: 1rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                                {release.data.description}
                            </p>
                            <a
                                href={`/releases/${release.slug}`}
                                style="font-size: 0.9rem; font-weight: bold; text-transform: uppercase;"
                            >
                                {data.buttonText || "Listen / Details"} &rarr;
                            </a>
                        </article>
                    ))}
                </div>
            )
        }
    </section>
    <style>
        .release-card:hover h2 {
            text-decoration: underline;
            text-decoration-color: var(--color-accent);
        }
        .release-card:hover .hover-zoom {
            transform: scale(1.05);
        }
    </style>
</BaseLayout>
