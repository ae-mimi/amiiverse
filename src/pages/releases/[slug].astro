---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import settings from "../../data/settings.json";

export async function getStaticPaths() {
    const releases = await getCollection("releases");
    return releases.map((release) => ({
        params: { slug: release.slug },
        props: { release },
    }));
}

const { release } = Astro.props;
const { Content } = await release.render();

const platforms = [
    { name: "Spotify", url: release.data.spotify, icon: "spotify" },
    { name: "Apple Music", url: release.data.apple, icon: "apple" },
    { name: "YouTube", url: release.data.youtube, icon: "youtube" },
    { name: "SoundCloud", url: release.data.soundcloud, icon: "soundcloud" },
    { name: "Audiomack", url: release.data.audiomack, icon: "audiomack" },
    { name: "Boomplay", url: release.data.boomplay, icon: "boomplay" },
    { name: "Deezer", url: release.data.deezer, icon: "deezer" },
    { name: "Tidal", url: release.data.tidal, icon: "tidal" },
    { name: "Amazon", url: release.data.amazon, icon: "amazon" },
].filter((p) => p.url); // Only show platforms with URLs

// Determine primary embed (First available of Spotify/YouTube/Apple)
// Logic: If YouTube exists, use it? Or Spotify? Spotify embed is cleaner for audio.
const embedUrl = release.data.spotify
    ? `https://open.spotify.com/embed/track/${release.data.spotify.split("/").pop()}?utm_source=generator&theme=0`
    : release.data.youtube
      ? `https://www.youtube.com/embed/${release.data.youtube.split("v=")[1]}`
      : null;

// Note: Real Spotify ID extraction is more complex usually, simplified here.
---
